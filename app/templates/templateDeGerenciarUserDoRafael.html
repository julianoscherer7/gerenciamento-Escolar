{% extends "base.html" %}

{% block title %}Gerenciamento de Usuários{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-center mb-3">Gerenciamento de Usuários</h1>

    <ul class="nav nav-tabs justify-content-center mt-4">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#cadastro_professores">Professores</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#cadastro_usuarios">Usuários</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#cadastro_recursos">Recursos Alugáveis</a>
        </li>
    </ul>

    <div class="tab-content mt-4">
        <div class="tab-pane fade show active" id="cadastro_professores">
            <div class="row">
                <div class="col-md-6">
                    <h2 class="mb-4">Cadastro de Professores</h2>
                    <form id="formProfessor" action="{{ url_for('admin.manage_users') }}" method="POST">
                        <input type="hidden" id="idProfessor" name="idProfessor" value="">
                        <div class="mb-3">
                            <label for="nomeProfessor" class="form-label">Nome do Professor</label>
                            <input type="text" class="form-control" id="nomeProfessor" name="nomeProfessor" placeholder="Insira o nome do professor" required>
                        </div>
                        <div class="mb-3">
                            <label for="areaProfessor" class="form-label">Área</label>
                            <input type="text" class="form-control" id="areaProfessor" name="areaProfessor" placeholder="Insira a área de especialização" required>
                        </div>
                        <div class="mb-3">
                            <label for="cargaHoraria" class="form-label">Carga Horária (horas/semana)</label>
                            <input type="number" class="form-control" id="cargaHoraria" name="cargaHoraria" placeholder="Insira a carga horária" required>
                        </div>
                        <div class="mb-3">
                            <label for="tipoContrato" class="form-label">Tipo de Contrato</label>
                            <select class="form-select" id="tipoContrato" name="tipoContrato" required>
                                <option value="" selected disabled>Escolha o tipo de contrato</option>
                                <option value="Efetivo">Efetivo</option>
                                <option value="Temporário">Temporário</option>
                                <option value="Horista">Horista</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="disponibilidade" class="form-label">Disponibilidade</label>
                            <input type="text" class="form-control" id="disponibilidade" name="disponibilidade" placeholder="Ex: Segunda a Sexta, manhã e tarde" required>
                        </div>
                        <button type="submit" id="btnSubmitProfessor" name="createProfessor" class="btn btn-primary w-100">Registrar Professor</button>
                    </form>
                </div>
                <div class="col-md-6">
                    <h3 class="mb-4">Professores Cadastrados</h3>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Área</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for professor in professores %}
                                <tr>
                                    <td>{{ professor.Nome }}</td>
                                    <td>{{ professor.Area }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-warning" onclick="editProfessor('{{ professor.ID_professor }}', '{{ professor.Nome }}', '{{ professor.Area }}', '{{ professor.CargaHoraria }}', '{{ professor.TipoContrato }}', '{{ professor.Disponibilidade }}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <form action="{{ url_for('admin.delete_professor', id=professor.ID_professor) }}" method="POST" style="display:inline-block;">
                                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Tem certeza que deseja remover este professor?')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="cadastro_usuarios">
            <div class="row">
                <div class="col-md-6">
                    <h2 class="mb-4">Cadastro de Usuário</h2>
                    <form id="formUsuario" action="{{ url_for('admin.manage_users') }}" method="POST">
                        <input type="hidden" id="idUsuario" name="idUsuario" value="">
                        <div class="mb-3">
                            <label for="nomeUsuario" class="form-label">Nome</label>
                            <input type="text" class="form-control" id="nomeUsuario" name="nomeUsuario" placeholder="Insira o nome do usuário" required>
                        </div>
                        <div class="mb-3">
                            <label for="cargoUsuario" class="form-label">Cargo</label>
                            <select class="form-select" id="cargoUsuario" name="cargoUsuario" required>
                                <option value="" selected disabled>Escolha o cargo</option>
                                <option value="Administrador">Administrador</option>
                                <option value="Professor">Professor</option>
                                <option value="Aluno">Aluno</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="emailUsuario" class="form-label">E-mail</label>
                            <input type="email" class="form-control" id="emailUsuario" name="emailUsuario" placeholder="Insira o e-mail do usuário" required>
                        </div>
                        <div class="mb-3">
                            <label for="senhaUsuario" class="form-label">Senha</label>
                            <input type="password" class="form-control" id="senhaUsuario" name="senhaUsuario" placeholder="Insira a senha">
                        </div>
                        <button type="submit" id="btnSubmitUsuario" name="createUser" class="btn btn-primary w-100">Registrar Usuário</button>
                    </form>
                </div>
                <div class="col-md-6">
                    <h3 class="mb-4">Usuários Registrados</h3>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Cargo</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for usuario in usuarios %}
                                <tr>
                                    <td>{{ usuario.Nome }}</td>
                                    <td>{{ usuario.Cargo }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-warning" onclick="editUser('{{ usuario.ID_usuario }}', '{{ usuario.Nome }}', '{{ usuario.Cargo }}', '{{ usuario.Email }}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <form action="{{ url_for('admin.delete_user', id=usuario.ID_usuario) }}" method="POST" style="display:inline-block;">
                                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Tem certeza que deseja remover este usuário?')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="cadastro_recursos">
            <div class="row">
                <div class="col-md-6">
                    <h2 class="mb-4">Cadastro de Recursos Alugáveis</h2>
                    <form id="formRecurso" action="{{ url_for('admin.manage_users') }}" method="POST">
                        <input type="hidden" id="idRecurso" name="idRecurso" value="">
                        <div class="mb-3">
                            <label for="quantidadeRecurso" class="form-label">Quantidade</label>
                            <input type="number" class="form-control" id="quantidadeRecurso" name="quantidadeRecurso" placeholder="Insira a quantidade de recursos" required>
                        </div>
                        <div class="mb-3">
                            <label for="identificacaoRecurso" class="form-label">Identificação</label>
                            <input type="text" class="form-control" id="identificacaoRecurso" name="identificacaoRecurso" placeholder="Insira a identificação do recurso" required>
                        </div>
                        <div class="mb-3">
                            <label for="statusRecurso" class="form-label">Status</label>
                            <select class="form-select" id="statusRecurso" name="statusRecurso" required>
                                <option value="" selected disabled>Escolha o status do recurso</option>
                                <option value="Disponível">Disponível</option>
                                <option value="Em Uso">Em Uso</option>
                                <option value="Reservado">Reservado</option>
                                <option value="Manutenção">Manutenção</option>
                            </select>
                        </div>
                        <button type="submit" id="btnSubmitRecurso" name="createRecurso" class="btn btn-primary w-100">Registrar Recurso</button>
                    </form>
                </div>
                <div class="col-md-6">
                    <h3 class="mb-4">Recursos Cadastrados</h3>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Identificação</th>
                                    <th>Quantidade</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for recurso in recursos %}
                                <tr>
                                    <td>{{ recurso.Identificacao }}</td>
                                    <td>{{ recurso.Quantidade }}</td>
                                    <td>{{ recurso.Status }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-warning" onclick="editRecurso('{{ recurso.ID_recurso }}', '{{ recurso.Quantidade }}', '{{ recurso.Identificacao }}', '{{ recurso.Status }}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <form action="{{ url_for('admin.delete_recurso', id=recurso.ID_recurso) }}" method="POST" style="display:inline-block;">
                                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Tem certeza que deseja remover este recurso?')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function editProfessor(id, nome, area, cargaHoraria, tipoContrato, disponibilidade) {
        document.getElementById('idProfessor').value = id;
        document.getElementById('nomeProfessor').value = nome;
        document.getElementById('areaProfessor').value = area;
        document.getElementById('cargaHoraria').value = cargaHoraria;
        document.getElementById('tipoContrato').value = tipoContrato;
        document.getElementById('disponibilidade').value = disponibilidade;
        document.getElementById('btnSubmitProfessor').innerText = 'Atualizar Professor';
        document.getElementById('btnSubmitProfessor').name = 'editProfessor';
        document.getElementById('cadastro_professores').scrollIntoView({behavior: 'smooth'});
    }

    function editUser(id, nome, cargo, email) {
        document.getElementById('idUsuario').value = id;
        document.getElementById('nomeUsuario').value = nome;
        document.getElementById('cargoUsuario').value = cargo;
        document.getElementById('emailUsuario').value = email;
        document.getElementById('btnSubmitUsuario').innerText = 'Atualizar Usuário';
        document.getElementById('btnSubmitUsuario').name = 'editUser';
        document.getElementById('cadastro_usuarios').scrollIntoView({behavior: 'smooth'});
    }

    function editRecurso(id, quantidade, identificacao, status) {
        document.getElementById('idRecurso').value = id;
        document.getElementById('quantidadeRecurso').value = quantidade;
        document.getElementById('identificacaoRecurso').value = identificacao;
        document.getElementById('statusRecurso').value = status;
        document.getElementById('btnSubmitRecurso').innerText = 'Atualizar Recurso';
        document.getElementById('btnSubmitRecurso').name = 'editRecurso';
        document.getElementById('cadastro_recursos').scrollIntoView({behavior: 'smooth'});
    }
</script>
{% endblock %}
